{% load companion %}
{% load i18n %}

<div class="panel">
    {% load tz %}
    {% if chats.count == 0 %}

    <div class="panel panel-body">
        {% trans "Нет ни одного начатого диалога" %}
    </div>

    {% endif %}
    <div id="accountChat">
        <div class="tab">
            {% for chat in chats %}
            {% if chat.message_set.count != 0 %}
            {% with last_message=chat.message_set.last %}
            {# выводит юзера с которым чат#}
            {% get_companion request.user chat as companion %}
            <button class="tablinks" data-id="{{ chat.id }}">
                <img class="avatar-messages" src="{{ companion.user_profile.avatar_or_default }}">
                {{ companion.username }}
            </button>
            {% endwith %}
            {% endif %}

            {% endfor %}
        </div>

        <div id="accountOpenChat">

            {% for chat in chats %}
            <div class="tabcontent" id="{{ chat.id }}">
                {# настроить вывод сообщений в этом цикле#}
                {{ chat.id }}

                {% if chat.message_set.count != 0 %}
                {% for message in chat.message_set.all %}
                {{ message }}
                {% endfor %}

                {#настроить отправку этой формы, урл настроен вроде)))))#}

                <form id="messageFormJs{{ chat.id }}" data-action="{% url 'messageapp:dialog' chat.id %}" method="post"
                    enctype="multipart/form-data" name="sendForm{{ chat.id }}">

                    {% csrf_token %}
                    <span>
                        <img src="/static/img/send_24px.png" alt="" id="registration__send{{ chat.id }}">
                    </span>
                    <div class="message__form" id="message__form{{ chat.id }}">

                        {{ form }}

                    </div>
                    <input type="submit" value="submit">
                </form>
            </div>
            {% endif %}
            {% endfor %}

        </div>

    </div>

</div>


</div>